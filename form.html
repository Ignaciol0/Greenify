<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenify - Eco-Friendly Project Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f0;
            color: #2c3e50;
            line-height: 1.6;
        }
        header {
            background-color: #4a674140;
            padding: 1rem;
        }
        .logo {
            display: flex;
            align-items: center;
        }
        .logo img {
            width: 40px;
            height: 40px;
            margin-right: 0.5rem;
        }
        .logo span {
            font-size: 1.25rem;
            font-weight: 900;
        }
        main {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #4a6741;
            margin-bottom: 1rem;
            text-align: center;
        }
        form {
            display: grid;
            gap: 1rem;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        input, select {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }
        button {
            background-color: #4a6741;
            color: white;
            padding: 0.75rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #3a5331;
        }
        footer {
            background-color: #4a6741;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }
        @media (max-width: 600px) {
            main {
                padding: 1rem;
            }
        }
        .phone-input {
            display: flex;
        }
        .phone-input select {
            width: 30%;
            margin-right: 10px;
        }
        .phone-input input {
            width: 70%;
        }
        .logo-link {
            text-decoration: none;
            color: inherit;
        }
    </style>
    <!-- Hotjar Tracking Code for Site 5174618 (name missing) -->
    <script>
        (function(h,o,t,j,a,r){
            h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
            h._hjSettings={hjid:5174618,hjsv:6};
            a=o.getElementsByTagName('head')[0];
            r=o.createElement('script');r.async=1;
            r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
            a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
</head>
<body>
    <header>
        <a href="index.html" class="logo-link" id="logoLink">
            <div class="logo">
                <img src="public/logo.png" alt="Greenify Logo">
                <span>Greenify</span>
            </div>
        </a>
    </header>

    <main>
        <h1>Register for Eco-Friendly Projects</h1>
        <form id="registrationForm">
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="contactType">Preferred Contact Method:</label>
                <select id="contactType" name="contactType" required>
                    <option value="">Select contact method</option>
                    <option value="email">Email</option>
                    <option value="phone">Phone</option>
                </select>
            </div>
            <div class="form-group" id="emailGroup" style="display:none;">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email">
            </div>
            <div class="form-group" id="phoneGroup" style="display:none;">
                <label for="phone">Phone:</label>
                <div class="phone-input">
                    <select id="phonePrefix" name="phonePrefix">
                    </select>
                    <input type="tel" id="phone" name="phone">
                </div>
            </div>
            <div class="form-group">
                <label for="country">Country:</label>
                <select id="country" name="country" required>
                    <option value="UAE">United Arab Emirates</option>
                    <option value="KSA">Saudi Arabia</option>
                    <option value="Qatar">Qatar</option>
                    <option value="Bahrain">Bahrain</option>
                    <option value="Kuwait">Kuwait</option>
                    <option value="Oman">Oman</option>
                    <option value="Afghanistan">Afghanistan</option>
                    <option value="Albania">Albania</option>
                    <option value="Algeria">Algeria</option>
                    <option value="Andorra">Andorra</option>
                    <option value="Angola">Angola</option>
                    <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Armenia">Armenia</option>
                    <option value="Australia">Australia</option>
                    <option value="Austria">Austria</option>
                    <option value="Azerbaijan">Azerbaijan</option>
                    <option value="Bahamas">Bahamas</option>
                    <option value="Bangladesh">Bangladesh</option>
                    <option value="Barbados">Barbados</option>
                    <option value="Belarus">Belarus</option>
                    <option value="Belgium">Belgium</option>
                    <option value="Belize">Belize</option>
                    <option value="Benin">Benin</option>
                    <option value="Bhutan">Bhutan</option>
                    <option value="Bolivia">Bolivia</option>
                    <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                    <option value="Botswana">Botswana</option>
                    <option value="Brazil">Brazil</option>
                    <option value="Brunei">Brunei</option>
                    <option value="Bulgaria">Bulgaria</option>
                    <option value="Burkina Faso">Burkina Faso</option>
                    <option value="Burundi">Burundi</option>
                    <option value="Yemen">Yemen</option>
                    <option value="Zambia">Zambia</option>
                    <option value="Zimbabwe">Zimbabwe</option>
                </select>
            </div>
            <div class="form-group" id="emirateGroup">
                <label for="emirate">Emirate:</label>
                <select id="emirate" name="emirate">
                    <option value="Abu Dhabi">Abu Dhabi</option>
                    <option value="Dubai">Dubai</option>
                    <option value="Sharjah">Sharjah</option>
                    <option value="Ajman">Ajman</option>
                    <option value="Umm Al Quwain">Umm Al Quwain</option>
                    <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                    <option value="Fujairah">Fujairah</option>
                    <option value="outside UAE">Outside UAE</option>
                </select>
            </div>
            <button type="submit">Register</button>
        </form>
    </main>

    <footer>
        <p>&copy; 2024 Greenify. All rights reserved.</p>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <!-- Your existing script -->
    <script>
        // Initialize Firebase (replace with your actual Firebase config)
        // Your web app's Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyBY2EBA0KnOYZDjxCwSHBMGcLaFjG6IL4o",
        authDomain: "greenify-e91f0.firebaseapp.com",
        projectId: "greenify-e91f0",
        storageBucket: "greenify-e91f0.appspot.com",
        messagingSenderId: "995349170683",
        appId: "1:995349170683:web:10bc48311fbf4a2710235e",
        measurementId: "G-1FP8G4JTGR"
      };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registrationForm');
            const contactTypeSelect = document.getElementById('contactType');
            const emailGroup = document.getElementById('emailGroup');
            const phoneGroup = document.getElementById('phoneGroup');
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const countrySelect = document.getElementById('country');
            const emirateSelect = document.getElementById('emirate');
            const phonePrefixSelect = document.getElementById('phonePrefix');

            // Handle contact type selection
            contactTypeSelect.addEventListener('change', function() {
                if (this.value === 'email') {
                    emailGroup.style.display = 'block';
                    phoneGroup.style.display = 'none';
                    emailInput.required = true;
                    phoneInput.required = false;
                } else if (this.value === 'phone') {
                    emailGroup.style.display = 'none';
                    phoneGroup.style.display = 'block';
                    emailInput.required = false;
                    phoneInput.required = true;
                } else {
                    emailGroup.style.display = 'none';
                    phoneGroup.style.display = 'none';
                    emailInput.required = false;
                    phoneInput.required = false;
                }
            });

            // Handle country selection
            countrySelect.addEventListener('change', function() {
                if (this.value === 'UAE') {
                    emirateSelect.value = '';
                    emirateSelect.disabled = false;
                } else {
                    emirateSelect.value = 'outside UAE';
                    emirateSelect.disabled = true;
                }
            });

            // Populate phone prefixes
            const phonePrefixes = {
                'UAE': '+971', 'KSA': '+966', 'Qatar': '+974', 'Bahrain': '+973', 'Kuwait': '+965', 'Oman': '+968',
                'Afghanistan': '+93', 'Albania': '+355', 'Algeria': '+213', 'Andorra': '+376', 'Angola': '+244',
                'Argentina': '+54', 'Armenia': '+374', 'Australia': '+61', 'Austria': '+43', 'Azerbaijan': '+994',
                'Bahamas': '+1242', 'Bangladesh': '+880', 'Belarus': '+375', 'Belgium': '+32', 'Belize': '+501',
                'Benin': '+229', 'Bhutan': '+975', 'Bolivia': '+591', 'Bosnia and Herzegovina': '+387', 'Botswana': '+267',
                'Brazil': '+55', 'Brunei': '+673', 'Bulgaria': '+359', 'Burkina Faso': '+226', 'Burundi': '+257',
                'Cambodia': '+855', 'Cameroon': '+237', 'Canada': '+1', 'Cape Verde': '+238', 'Central African Republic': '+236',
                'Chad': '+235', 'Chile': '+56', 'China': '+86', 'Colombia': '+57', 'Comoros': '+269', 'Congo': '+242',
                'Costa Rica': '+506', 'Croatia': '+385', 'Cuba': '+53', 'Cyprus': '+357', 'Czech Republic': '+420',
                'Denmark': '+45', 'Djibouti': '+253', 'Dominica': '+1767', 'Dominican Republic': '+1809', 'Ecuador': '+593',
                'Egypt': '+20', 'El Salvador': '+503', 'Equatorial Guinea': '+240', 'Eritrea': '+291', 'Estonia': '+372',
                'Ethiopia': '+251', 'Fiji': '+679', 'Finland': '+358', 'France': '+33', 'Gabon': '+241', 'Gambia': '+220',
                'Georgia': '+995', 'Germany': '+49', 'Ghana': '+233', 'Greece': '+30', 'Grenada': '+1473', 'Guatemala': '+502',
                'Guinea': '+224', 'Guinea-Bissau': '+245', 'Guyana': '+592', 'Haiti': '+509', 'Honduras': '+504',
                'Hungary': '+36', 'Iceland': '+354', 'India': '+91', 'Indonesia': '+62', 'Iran': '+98', 'Iraq': '+964',
                'Ireland': '+353', 'Israel': '+972', 'Italy': '+39', 'Jamaica': '+1876', 'Japan': '+81', 'Jordan': '+962',
                'Kazakhstan': '+7', 'Kenya': '+254', 'Kiribati': '+686', 'North Korea': '+850', 'South Korea': '+82',
                'Kosovo': '+383', 'Kyrgyzstan': '+996', 'Laos': '+856', 'Latvia': '+371', 'Lebanon': '+961', 'Lesotho': '+266',
                'Liberia': '+231', 'Libya': '+218', 'Liechtenstein': '+423', 'Lithuania': '+370', 'Luxembourg': '+352',
                'Macedonia': '+389', 'Madagascar': '+261', 'Malawi': '+265', 'Malaysia': '+60', 'Maldives': '+960',
                'Mali': '+223', 'Malta': '+356', 'Marshall Islands': '+692', 'Mauritania': '+222', 'Mauritius': '+230',
                'Mexico': '+52', 'Micronesia': '+691', 'Moldova': '+373', 'Monaco': '+377', 'Mongolia': '+976',
                'Montenegro': '+382', 'Morocco': '+212', 'Mozambique': '+258', 'Myanmar': '+95', 'Namibia': '+264',
                'Nauru': '+674', 'Nepal': '+977', 'Netherlands': '+31', 'New Zealand': '+64', 'Nicaragua': '+505',
                'Niger': '+227', 'Nigeria': '+234', 'Norway': '+47', 'Pakistan': '+92', 'Palau': '+680', 'Palestine': '+970',
                'Panama': '+507', 'Papua New Guinea': '+675', 'Paraguay': '+595', 'Peru': '+51', 'Philippines': '+63',
                'Poland': '+48', 'Portugal': '+351', 'Romania': '+40', 'Russia': '+7', 'Rwanda': '+250', 'Saint Kitts and Nevis': '+1869',
                'Saint Lucia': '+1758', 'Saint Vincent and the Grenadines': '+1784', 'Samoa': '+685', 'San Marino': '+378',
                'Sao Tome and Principe': '+239', 'Senegal': '+221', 'Serbia': '+381', 'Seychelles': '+248', 'Sierra Leone': '+232',
                'Singapore': '+65', 'Slovakia': '+421', 'Slovenia': '+386', 'Solomon Islands': '+677', 'Somalia': '+252',
                'South Africa': '+27', 'South Sudan': '+211', 'Spain': '+34', 'Sri Lanka': '+94', 'Sudan': '+249',
                'Suriname': '+597', 'Swaziland': '+268', 'Sweden': '+46', 'Switzerland': '+41', 'Syria': '+963',
                'Taiwan': '+886', 'Tajikistan': '+992', 'Tanzania': '+255', 'Thailand': '+66', 'Togo': '+228', 'Tonga': '+676',
                'Trinidad and Tobago': '+1868', 'Tunisia': '+216', 'Turkey': '+90', 'Turkmenistan': '+993', 'Tuvalu': '+688',
                'Uganda': '+256', 'Ukraine': '+380', 'United Kingdom': '+44', 'United States': '+1', 'Uruguay': '+598',
                'Uzbekistan': '+998', 'Vanuatu': '+678', 'Vatican City': '+379', 'Venezuela': '+58', 'Vietnam': '+84',
                'Yemen': '+967', 'Zambia': '+260', 'Zimbabwe': '+263'
            };

            // Populate phone prefix options
            for (let country in phonePrefixes) {
                let option = document.createElement('option');
                option.value = phonePrefixes[country];
                option.textContent = `${country} (${phonePrefixes[country]})`;
                phonePrefixSelect.appendChild(option);
            }

            // Set default phone prefix based on country selection
            countrySelect.addEventListener('change', function() {
                const selectedCountry = this.value;
                const prefix = phonePrefixes[selectedCountry] || '';
                phonePrefixSelect.value = prefix;
            });

            // Retrieve the selected project title
            const selectedProject = localStorage.getItem('selectedProject') || 'No project selected';
            console.log('Retrieved project:', selectedProject); // For debugging

            // Add a hidden input field to the form to store the project title
            const projectTitleInput = document.createElement('input');
            projectTitleInput.type = 'hidden';
            projectTitleInput.name = 'projectTitle';
            projectTitleInput.value = selectedProject;
            form.appendChild(projectTitleInput);
            console.log('Hidden input added with value:', projectTitleInput.value); // For debugging

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const urlParams = new URLSearchParams(window.location.search);
                const intent = urlParams.get('intent');
                
                const formData = {
                    name: form.name.value,
                    country: countrySelect.value,
                    emirate: emirateSelect.value,
                    contactType: contactTypeSelect.value,
                    email: emailInput.value || null,
                    phone: contactTypeSelect.value === 'phone' ? phonePrefixSelect.value + phoneInput.value : null,
                    projectTitle: projectTitleInput.value,
                    intent: intent || 'default'  // Include the intent in the form data
                };

                console.log('Form data to be submitted:', formData);

                // Google Analytics event tracking
                gtag('event', 'form_submission', {
                    'event_category': 'Form Interaction',
                    'event_label': formData.projectTitle
                });

                // Add data to Firebase
                db.collection("userInfo").add(formData)
                    .then((docRef) => {
                        console.log("Document written with ID: ", docRef.id);
                        alert('Thank you for registering!');
                        form.reset();
                        emailGroup.style.display = 'none';
                        phoneGroup.style.display = 'none';
                        localStorage.removeItem('selectedProject');  // Clear the stored project
                        console.log('localStorage cleared'); // For debugging

                        // Google Analytics event tracking for successful submission
                        gtag('event', 'form_submission_success', {
                            'event_category': 'Form Interaction',
                            'event_label': formData.projectTitle
                        });
                    })
                    .catch((error) => {
                        console.error("Error adding document: ", error);
                        alert('There was an error submitting your registration. Please try again.');

                        // Google Analytics event tracking for submission error
                        gtag('event', 'form_submission_error', {
                            'event_category': 'Form Interaction',
                            'event_label': formData.projectTitle
                        });
                    });
            });

            // Add this after your existing event listeners
            const formFields = form.querySelectorAll('input, select');
            formFields.forEach(field => {
                field.addEventListener('change', function() {
                    gtag('event', 'form_field_change', {
                        'event_category': 'Form Interaction',
                        'event_label': this.name
                    });
                });
            });
        });
    </script>
    <script>
        function addIntentToLinks() {
            const urlParams = new URLSearchParams(window.location.search);
            const intent = urlParams.get('intent');
            if (intent) {
                document.querySelectorAll('a').forEach(link => {
                    if (link.href.includes(window.location.origin)) {
                        const url = new URL(link.href);
                        url.searchParams.set('intent', intent);
                        link.href = url.toString();
                    }
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            addIntentToLinks();
            
            // Update logo link
            const logoLink = document.getElementById('logoLink');
            const urlParams = new URLSearchParams(window.location.search);
            const intent = urlParams.get('intent');
            if (intent) {
                logoLink.href = `index.html?intent=${intent}`;
            }
        });
    </script>
</body>
</html>